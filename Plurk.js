var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
(function(){var a={id:"Plurk",DB:!1,Storage:{local:!1,session:!1},Clock:{setInterval:{},setTimeout:{}},flag:{plurk:{}},config:{canvas:{height:80,width:80},vote_max:6},template:{},style:function(){return"\n            :root{\n\n            }\n            #"+a.id+"{\n                display:none;\n            }\n\n            #"+a.id+"-Msg{\n                display:none;\n                border:1px solid #000;\n                border-radius: 5px;\n                background: #fff5;\n                position: absolute;\n                padding:5px;\n                color: #000;\n                z-index:9999;\n            }\n\n            #"+
a.id+'-Msg input[type="button"]{\n                padding: 4px 6px;\n                font-size: 12px;\n            }\n\n            #'+a.id+"-Menu{\n                display:none;\n                border:1px solid #000;\n                border-radius: 5px;\n                background: #fff5;\n                position: absolute;\n                padding:5px;\n                color: #000;\n            }\n\n            #"+a.id+"-Loading{\n                width: 100%;\n                height: 100%;\n                background:#222;\n                opacity: 1;\n                display: block;\n                transition-duration: 1s;\n                position: fixed;\n                cursor:wait;\n                z-index: 99;\n                color:#fff;\n            }\n            #"+
a.id+"-Loading div{\n                position: absolute;\n                height: 50px;\n                width: 50px;\n                top: calc(50% - 50px);\n                left: calc(50% - 50px);\n                border-radius: 50%;\n                background: transparent;\n            }\n\n            #"+a.id+"-Loading div:nth-child(1){\n\n                border-top:3px solid #aaa;\n                animation: load 1s infinite linear;\n            }\n\n            #"+a.id+'-Loading div:nth-child(2){\n                top: calc(50% - -10px);\n                left: calc(50% - 58px);\n            }\n\n            @keyframes load {\n                to {\n                    transform: rotateZ(360deg);\n                }\n            }\n\n            canvas{\n                position: absolute;\n                left: 100%;\n                border-radius: 50%;\n                border: 1px double #fff;\n                transition-duration: 0.8s;\n            }\n            canvas:hover{\n                transform: scale(1.2);\n            }\n\n            div#VoteInfo{\n                position: absolute;\n                width: auto;\n                height: auto;\n                left: 100%;\n                top: 90px;\n                background: #fff8;\n                color: #000;\n                padding: 2px 2px;\n                margin: 2px;\n                border-radius: 5px;\n                border: 2px double #fff;\n                opacity:0;\n                transition-duration: 0.8s;\n            }\n            div#VoteInfo:hover{\n                opacity:1 !important;\n            }\n            div#VoteInfo li{\n\n                border-radius: 5px;\n                padding: 1px 8px;\n                margin-bottom: 2px;\n            }\n\n            div#VoteOption {\n                display: grid;\n                min-width: 110px;\n            }\n\n            div#VoteOption input[type="text"]{\n                width: 100px;\n            }\n\n            div#VoteOption span{\n                display:none;\n                color:#f00;\n                width: 0px;\n                margin: -20px 0 0 104px;\n            }\n            div#VoteOption span.error{\n                display:block;\n            }\n\n            #response-search {\n                transition-duration: 0.3s;\n                position: absolute;\n                z-index: 9999;\n                display: inline;\n                margin-top: 0px;\n                margin-left: 260px;\n            }\n\n            #response-search input{\n                height: 20px;\n                font-size: 12px;\n                width: 80px;\n            }\n\n\n\n            '},
obj:{},f:{GetPlurk:function(b){a.flag.plurk[b]=PlurksManager.getPlurkById(b);a.f.GetRePlurk(b)},GetRePlurk:function(b){ResponsesManager.loadResponses(b);var c=setInterval(function(){0!==ResponsesManager.getPlurkResponses(b).length&&(clearInterval(c),ResponsesManager.loadOlderResponses(b,!0),a.flag.plurk[b]._replurk=ResponsesManager.getPlurkResponses(b),99999!==a.flag.plurk[b].owner_id&&(a.flag.plurk[b]._re_user=ResponsesManager.getPlurkResponsesUsers(b).map(function(d){return Users.getUserById(d)})),
-1!==document.querySelector('div[data-pid="'+b+'"]').innerHTML.indexOf("\u3010\u6295\u7968\u3011")&&a.f.RePlurkToPieChart(b))},500)},RePlurkToPieChart:function(b){replurk=a.flag.plurk[b]._replurk;if(void 0===replurk[0])document.querySelector('.block_cnt:nth-child(1)>div[data-uid="'+GLOBAL.session_user.uid+'"][data-pid="'+b+'"]').querySelectorAll("canvas,#VoteInfo").forEach(function(e){e.remove()});else{b=document.querySelector('.block_cnt:nth-child(1)>div[data-uid="'+GLOBAL.session_user.uid+'"][data-pid="'+
b+'"]');var c=a.flag.plurk[replurk[0].plurk_id];c._vote={1:0,2:0,3:0,4:0,5:0,6:0};var d=[];replurk.forEach(function(e){!0===isNaN(parseInt(e.content))||-1!==d.indexOf(e.user_id)||e.content>a.config.vote_max||(d.push(e.user_id),c._vote[e.content]=(c._vote[e.content]||0)+1)});0<Object.keys(c._vote).length&&a.f.PieChart(b)}},plurk_obj_set:function(){a.obj.vote_btn=document.createElement("div");a.obj.vote_btn.className="submit_img submit_img_color";a.obj.vote_btn.style.fontSize="20px";a.obj.vote_btn.innerHTML=
"\u767c\u8d77\u6295\u7968";a.obj.vote_btn.dataset.event="ClickEvent";a.obj.vote_btn.dataset.mode="CreateVote";document.querySelector(".plurkForm:not(.mini-mode) .submit_img").parentElement.insertBefore(a.obj.vote_btn,document.querySelector(".plurkForm:not(.mini-mode) .submit_img"));console.log("plurk_obj_set");a.Clock.setInterval.GetVotePlurk=setInterval(function(){document.querySelectorAll('.block_cnt:nth-child(1)>div[data-uid="'+GLOBAL.session_user.uid+'"]').forEach(function(b){-1!==b.innerHTML.indexOf("\u3010\u6295\u7968\u3011")&&
(void 0===a.flag.plurk[b.dataset.pid]&&a.f.GetPlurk(b.dataset.pid),void 0!==a.flag.plurk[b.dataset.pid]._replurk&&a.f.RePlurkToPieChart(b.dataset.pid))});document.querySelectorAll("#cbox_response,#form_holder").forEach(function(b){if(null!==b.querySelector("#response-search"))b.querySelector("#response-search").style.marginTop=b.querySelector(".response_box").scrollTop+"px";else{console.log("o.querySelector(`#response-search`)");var c=document.createElement("div");c.id="response-search";c.innerHTML=
'\n\n                                <input type="text" id="content" placeholder="\u5167\u5bb9">\n                                <input type="text" id="name" placeholder="\u66b1\u7a31(\u5e33\u865f)">\n                            ';b.querySelector(".response_info").prepend(c);c.querySelectorAll("input").forEach(function(d){d.addEventListener("keydown",a.f.ReplurkSearch)})}})},1E3)},ReplurkSearch:function(b){if("enter"===b.code.toLocaleLowerCase()||"numpadenter"===b.code.toLocaleLowerCase()){var c=
b.path[3],d=c.querySelector(".list .cboxAnchor").dataset.pid;a.f.GetPlurk(d);c.querySelectorAll("[data-rid]").forEach(function(g){g.style.display="none"});var e=b.target.parentElement.querySelector("#content").value,h=b.target.parentElement.querySelector("#name").value;setTimeout(function(){a.flag.plurk[d]._replurk.forEach(function(g){var f=a.flag.plurk[d]._re_user||[],k=(f.find(function(l){return l.uid===g.user_id})||{}).display_name||"";f=(f.find(function(l){return l.uid===g.user_id})||{}).nick_name||
"";var m=g.handle||"";-1===g.content_raw.indexOf(e)||-1===m.indexOf(h)&&-1===k.indexOf(h)&&-1===f.indexOf(h)||!document.querySelector('[data-rid="'+g.id+'"]')||(document.querySelector('[data-rid="'+g.id+'"]').style.display="block")});c.scrollTo(0,0)},500)}},PieChart:function(b){null===b.querySelector("canvas")&&(b.innerHTML='\n                        <canvas style="opacity:0;"\n                        data-m_event="MouseEvent"\n                        data-mode="VoteInfo"\n                        height="'+
a.config.canvas.height+'" width="'+a.config.canvas.width+'">\n                        </canvas>\n                        <div id="VoteInfo"></div>\n                        '+b.innerHTML+"\n                    ",b.querySelector("canvas").addEventListener("mouseleave",function(q){q.target.parentElement.querySelector("div#VoteInfo").style.opacity="0"}));var c=b.querySelector("canvas"),d=c.getContext("2d"),e=Math.floor(c.width/2),h=Math.floor(c.height/2),g=2*Math.PI,f=0,k=a.flag.plurk[c.parentElement.dataset.pid]._vote,
m=Object.values(k).reduce(function(q,t){return q+t}),l="#8f8681 #32435F #E4B660 #FE7773 #028C6A #1D6A96".split(" "),r="",n=0,p;for(p in k)r+='<li style="background:'+l[n]+'8">'+(n+1)+"\uff1a"+k[p]+"\u7968("+Math.floor(k[p]/m*100)+"%)</li>",c=f+k[p],d.beginPath(),d.moveTo(e,h),d.arc(e,h,e,f/m*g,c/m*g),f=d.createRadialGradient(e,h,0,e,h,e),f.addColorStop(0,"#888"),f.addColorStop(1,l[n]),d.fillStyle=f,d.strokeStyle="#fff",d.fill(),n++,f=c;r+="<li>\u7e3d\u7968\u6578\uff1a"+m+"</li>";b.querySelector("#VoteInfo").innerHTML=
"<ul>"+r+"</ul>";setTimeout(function(){null!==b.querySelector("canvas")&&(b.querySelector("canvas").style.opacity="1")},1E3)},ClickEvent:function(b){switch(b.target.dataset.mode){case "CreateVote":b=new MouseEvent("click",{clientX:Math.floor(window.innerWidth/2),clientY:Math.floor(window.innerHeight/4)});a.f.MsgPop('\n                        <div id="VoteOption">\n                        <input type="text" placeholder="\u9078\u98051"><span>*</span>\n                        <input type="text" placeholder="\u9078\u98052"><span>*</span>\n                        </div>\n                        <input\n                        data-event="ClickEvent"\n                        data-mode="SubmitVote"\n                        type="button" value="\u9001\u51fa">\n                        <input\n                        data-event="ClickEvent"\n                        data-mode="AddOption"\n                        type="button" value="\u589e\u52a0\u9078\u9805">',
b);break;case "AddOption":var c=document.createElement("input");c.type="text";c.setAttribute("placeholder","\u9078\u9805"+(b.target.parentElement.querySelectorAll('input[type="text"]').length+1));var d=document.createElement("span");d.innerHTML="*";b.target.parentElement.querySelector("div").appendChild(c);b.target.parentElement.querySelector("div").appendChild(d);b.target.parentElement.querySelectorAll('input[type="text"]').length>=a.config.vote_max&&b.target.setAttribute("disabled","disabled");
break;case "SubmitVote":var e="\u3010\u6295\u7968\u3011\n"+document.querySelector("#input_big").value+"\n",h=!1;b.target.parentElement.querySelectorAll('input[type="text"]').forEach(function(g,f){""===g.value?(g.focus(),b.target.parentElement.querySelectorAll("span")[f].classList.add("error"),h=!0):b.target.parentElement.querySelectorAll("span")[f].classList.remove("error");e+="\u3010"+(f+1)+"\u3011"+g.value+"\n"});h||(PlurkAdder.addPlurk({qualifier:":",content:e}),a.f.MsgPop("\u6295\u7968\u5657\u5efa\u7acb\u5b8c\u6210",
b))}},MouseEvent:function(b){switch(b.target.dataset.mode){case "VoteInfo":b.target.parentElement.querySelector("div#VoteInfo").style.opacity="1"}},DB_set:function(b,c){if("undefined"!==typeof firebase)a.DB=firebase,a.DB=a.DB.database(),c();else{var d=document.createElement("script");d.src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js";document.head.appendChild(d);var e=setInterval(function(){"undefined"!==typeof firebase&&(clearInterval(e),a.DB=firebase,a.DB.initializeApp({databaseURL:b}),
a.DB=a.DB.database(),c())},100)}},style_set:function(){a.obj.styleSheet=document.createElement("style");a.obj.styleSheet.title=a.id;a.obj.styleSheet.innerText=a.style();document.head.appendChild(a.obj.styleSheet)},obj_set:function(){a.obj.Ex_div=document.createElement("div");a.obj.Ex_div.setAttribute("draggable","true");a.obj.Ex_div.id=a.id;a.obj.Ex_div.innerHTML="";a.obj.msg=document.createElement("div");a.obj.msg.id=a.id+"-Msg";a.obj.msg.setAttribute("draggable","true");a.obj.msg.innerHTML='\n                <div></div>\n                <input type="button" data-event="close" data-obj="'+
a.id+'-Msg" value="\u95dc\u9589">\n                ';a.obj.menu=document.createElement("div");a.obj.menu.id=a.id+"-Menu";a.obj.menu.setAttribute("draggable","true");a.obj.menu.innerHTML="\n                <ul>\n                </ul>\n                ";a.obj.load=document.createElement("div");a.obj.load.id=a.id+"-Loading";a.obj.load.innerHTML="\n                <div></div>\n                <div>LOADING...</div>\n                ";document.body.appendChild(a.obj.Ex_div);document.body.appendChild(a.obj.msg);
document.body.appendChild(a.obj.menu)},FlagUpd:function(){document.querySelectorAll("[data-flag]").forEach(function(b){b.innerHTML=a.flag[b.dataset.flag]})},StorageUpd:function(){localStorage[a.id]=JSON.stringify(a.Storage.local);sessionStorage[a.id]=JSON.stringify(a.Storage.session)},MsgPop:function(b,c){c=void 0===c?document.createEvent("mouseEvents"):c;a.obj.msg.style.left=c.clientX+"px";a.obj.msg.style.top=c.clientY+"px";a.obj.msg.style.display="block";a.obj.msg.querySelector("div").innerHTML=
b},close:function(b){document.querySelector("#"+b.target.dataset.obj).style.display="none"},rad:function(b){return Math.floor(Math.random()*b)+1},shuffle:function(b){for(var c=b.length-1;0<c;c--){var d=Math.floor(Math.random()*(c+1)),e=$jscomp.makeIterator([b[d],b[c]]);b[c]=e.next().value;b[d]=e.next().value}},"default":function(){1<document.querySelectorAll(".plurkForm:not(.mini-mode) .submit_img").length||(document.addEventListener("dragend",function(b){"true"===b.target.getAttribute("draggable")&&
(b.target.style.left=b.clientX-a.flag.mousedown.offsetX+"px",b.target.style.top=b.clientY-a.flag.mousedown.offsetY+"px","true"===b.target.dataset.draggable_remove&&-1*b.target.style.top.split("px")[0]>=Math.floor(b.target.clientHeight/2)&&b.target.remove())}),document.addEventListener("mouseover",function(b){if(void 0!==b.target.dataset.m_event)a.f[b.target.dataset.m_event](b)}),document.addEventListener("mousedown",function(b){a.flag.mousedown=b}),document.addEventListener("click",function(b){if(void 0!==
b.target.dataset.event)a.f[b.target.dataset.event](b)}),document.addEventListener("contextmenu",function(b){void 0!==b.target.dataset.r_event&&(b.stopPropagation(),b.preventDefault(),a.f[b.target.dataset.r_event](b))}),a.Storage={local:JSON.parse(localStorage[a.id]||"{}"),session:JSON.parse(sessionStorage[a.id]||"{}")},a.f.style_set(),a.f.obj_set(),a.f.plurk_obj_set())}}};a.f["default"]()})();
